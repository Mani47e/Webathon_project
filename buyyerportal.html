<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyer Portal</title>
  <link rel="stylesheet" href="buyerportal.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    #clear-search {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      cursor: pointer;
      color: #333;
      display: none;
    }
    .cart-icon {
      height: 24px;
      margin-left: 5px;
    }
    .added-effect {
      background-color: #28a745;
      color: white;
    }
  </style>
</head>
<body>
  <header class="bg-success text-white p-3">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="logo">
        <img src="Images/Logo.jpeg" alt="Logo" height="40">
      </div>
      <div class="location d-flex align-items-center">
        <label for="location" class="mr-2">Deliver to:</label>
        <select id="location" class="form-control mr-2">
          <option value="RHR">RHR</option>
          <option value="BHR">BHR</option>
          <option value="MHR">MHR</option>
          <option value="GHR">GHR</option>
          <option value="SHR">SHR</option>
          <option value="FACULTY QUARTERS">FACULTY QUARTERS</option>
        </select>
        <span id="current-location" class="ml-2 text-light small font-weight-bold"></span>
      </div>
      <div class="search-bar w-50 position-relative">
        <input type="text" class="form-control" id="search-input" placeholder="Search for products..." oninput="toggleClearButton()">
        <span id="clear-search" onclick="clearSearch()">&times;</span>
      </div>
      <div class="account position-relative">
        <button class="btn btn-outline-light dropdown-toggle" onclick="toggleDropdown()">Account</button>
        <ul class="dropdown-menu" id="account-dropdown">
          <li><a href="#order-history" class="dropdown-item">Order History</a></li>
          <li><a href="#contact" class="dropdown-item">Contact</a></li>
          <li><a href="#" class="dropdown-item">Logout</a></li>
        </ul>
      </div>
      <div class="user-actions">
        <button class="btn btn-outline-light d-flex align-items-center" id="cart-button">
          <img src="Images/shopping-cart.png" alt="Cart" class="cart-icon">
        </button>
      </div>
    </div>
  </header>

  <section class="delivery-slot p-3">
    <div class="container">
      <h4>Select a Delivery Slot:</h4>
      <select id="delivery-slot" class="form-control w-50">
        <option value="Morning">Morning (8 AM - 11 AM)</option>
        <option value="Afternoon">Afternoon (12 PM - 3 PM)</option>
        <option value="Evening">Evening (4 PM - 7 PM)</option>
        <option value="Night">Night (8 PM - 11 PM)</option>
      </select>
    </div>
  </section>

  <section class="categories py-4">
    <div class="container">
      <h2 class="mb-4">Shop by Categories</h2>
      <div class="row">
        <!-- Category Cards -->
        <div class="col-md-3 mb-4" *ngFor="let category of categories">
          <div class="card text-center">
            <img src="Images/{{category.image}}" class="card-img-top" alt="{{category.alt}}">
            <div class="card-body">
              <h5 class="card-title">{{category.name}}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="products py-4 bg-light">
    <div class="container">
      <h2 class="mb-4">Recommended Products</h2>
      <div class="row">
        <!-- Product Cards -->
        <div class="col-md-3 mb-4" *ngFor="let product of products">
          <div class="card text-center">
            <img src="Images/{{product.image}}" class="card-img-top" alt="{{product.alt}}">
            <div class="card-body">
              <h5 class="card-title">{{product.name}}</h5>
              <p class="card-text">{{product.price}}</p>
              <button class="btn btn-success add-to-cart" onclick="addToCart(this)">Add to Cart</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="bg-dark text-white py-3">
    <div class="container text-center">
      <p>&copy; 2025. All rights reserved.</p>
    </div>
  </footer>

  <script>
    function detectLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      }
    }
    function showPosition(position) {
      let lat = position.coords.latitude;
      let lon = position.coords.longitude;
      fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
        .then(response => response.json())
        .then(data => {
          let address = data.address.suburb || data.address.village || data.address.town || data.address.city;
          document.getElementById("current-location").innerText = "Detected: " + address;
          let locationDropdown = document.getElementById("location");
          let locationOptions = Array.from(locationDropdown.options).map(opt => opt.value);
          if (!locationOptions.includes(address)) {
            let newOption = document.createElement("option");
            newOption.value = address;
            newOption.text = address + " (Detected)";
            locationDropdown.appendChild(newOption);
          }
          locationDropdown.value = address;
        })
        .catch(() => {
          document.getElementById("current-location").innerText = "Unable to retrieve location.";
        });
    }
    function showError(error) {
      let message = {
        1: "User denied location access.",
        2: "Location information unavailable.",
        3: "Location request timed out."
      }[error.code] || "An unknown error occurred.";
      document.getElementById("current-location").innerText = message;
    }
    function toggleDropdown() {
      document.getElementById("account-dropdown").classList.toggle("show");
    }
    function toggleClearButton() {
      let input = document.getElementById("search-input");
      let clear = document.getElementById("clear-search");
      clear.style.display = input.value ? "flex" : "none";
    }
    function clearSearch() {
      document.getElementById("search-input").value = "";
      document.getElementById("clear-search").style.display = "none";
    }
    window.onclick = function(e) {
      if (!e.target.matches('.dropdown-toggle')) {
        let dropdowns = document.getElementsByClassName("dropdown-menu");
        for (let d of dropdowns) d.classList.remove("show");
      }
    }
    function addToCart(btn) {
      btn.innerText = btn.innerText === "Add to Cart" ? "Added" : "Add to Cart";
      btn.classList.toggle("added-effect");
    }
  </script>
</body>
</html>
